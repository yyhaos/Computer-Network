## LAB-PROTOCOL-LAYERS

#### PREPARE

下载wget安装包 [](https://jaist.dl.sourceforge.net/project/gnuwin32/wget/1.11.4-1/wget-1.11.4-1-setup.exe)  

并且设置好相应的系统变量。

#### Step 1: Capture a Trace

##### 1 选用网页：http://www.hdu.edu.cn/index.php 航电的主页

用命令：`wget www.hdu.edu.cn`

![](res/cap1.png)

捕获得到200 OK。

##### 2 关闭无关程序

##### 3 启动wire shark 并且设置filter
![](res/cap2.png)
电脑用的是wlan连接网络。
##### 4 捕获
在启动wire shark捕获后，再次运行命令`wget www.hdu.edu.cn`
##### 5 捕获结果
![](res/cap3.png)
其中60.12.8.181就是www.hdu.edu.cn 对应的一个ip，共捕获了77个包（分组数据）
#### Step 2: Inspect the Trace

#### 1 get

![](res/ins1.png)
针对第四个包进行查看，该包使用了HTTP协议。

#####　协议栈
它对应的协议栈如下：
![](res/ins2.png)
从上到下依次是: 帧, 以太2, IPV4, TCP, HTTP. 

它们在包内的顺序也是从前到后的.

不同的协议占的位数不一样.

#### 2 回复

![](res/ins3.png)

回复在第70个包中,含有200 OK.

##### 协议栈

它对应的协议栈如下:

![](res/ins4.png)

#### Step 3: Packet Structure

##### GET包每个协议占的字节数

Frame 4: 				156字节(不是某一个协议,而是这个帧的总大小)

Ethernet 2, Src: 	14字节

IPV4:						20字节

TCP:						20字节

HTTP:					102字节

图就不画了. 协议间依次排列. 更底层的协议更靠前.

##### 回复包每个协议占的字节数

Frame 70:				60字节

Ethernet 2, Src:		20字节(前14个字节+包的最后6个字节,后面的全是0)

IPV4:						20字节

TCP:							20字节

53 Reassembled TCP Segments:	69606字节(不是这个包里的,是其他包的连接信息) 它们一块构成了HTTP协议(分散在其他包里)

#### Step 4: Protocol Overhead

##### 估计假设

估计每个包的Ethernet 2,Src 协议占的都是14字节(有少量占20字节,还是都算作14字节)

估计每个包的IPV4协议占20字节.

估计每个包的TCP协议占20字节.

##### 下载包的数量

对Destination进行排序:

![](res/est1.png)

找到所有Destination=192.168.1.108的包  (都是收到的包)

一共收到有58个包:

![](res/est2.png)

##### 估计

这58个包 共有Ethernet + IPV4 + TCP协议的估计字节= 58*(14+20+20)=3132字节

所以对应的开销大约是3132字节.

##### 有效数据

再次查看刚才的回复的包的协议栈:

![](res/ins4.png)

它给出了在其他包中 下载的有效数据总量(69606字节)

#### Step 5: Demultiplexing Keys

基本上任意一个包都用的是以太+IPv4+TCP的协议栈

##### 1 以太协议包涵IPv4

打开一个包的以太协议:

![](res/dem1.png)

可以看到,它有个字段是Type,然后值是IPv4(0x0800),所以应该就是这个字段是多路分解键.

##### 2 IP协议包涵TCP

打开一个包的IP协议:

![](res/dem2.png)

它有个字段叫做Protocol, 值是TCP(0x06), 所以应该是这个字段是多路分解键.