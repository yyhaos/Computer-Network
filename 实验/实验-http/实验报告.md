## LAB-HTTP 2020.5.5

#### Step 1: Manual GET with Telnet

##### 选用网页：http://www.hdu.edu.cn/index.php 航电的主页

http://www.hdu.edu.cn/index.php 的服务器名是 www.hdu.edu.cn，路径是/index.php

##### 尝试用telnet获得网页：

###### 1 用telnet连接服务器

`telnet www.hdu.edu 80`

![](res/tel1.png)

连接成功（win10需要以管理员身份运行）

###### 2 get网页

输入：

`GET /index.php HTTP/1.1`

`Host: www.hdu.edu.cn`

`      `

![](res/tel2.png)

得到了一个html网页，网页的内容都显示在了命令行中。

###### 3 关闭

![](res/tel3.png)

过了一会 自己关闭了。

##### 问题1 服务器的HTTP版本

HTTP/1.1（大部分服务器都是）

##### 问题2 客户端如何识别服务器发送的内容的开头？

看内容的前几位是不是HTTP

##### 问题3 客户端如何知道返回的内容类型？

看返回的Content-type字段，例子中的就是text/html类型。

#### Step 2: Capture a Trace

##### 1 找到两个网站

第一个：http://www.hdu.edu.cn/asset/home/images/logo.png 航电的logo

第二个：http://www.hdu.edu.cn/index.php 航电的主页

##### 2 准备

关闭无关的网页。

##### 3 设置filter

![](res/cap1.png)

##### 4 捕获

按步骤 先图片，等待十秒，再图片，再等待十秒，最后访问主页。

![](res/cap2.png)

##### 5 停止

![](res/cap3.png)

只看HTTP协议的内容。

#### Step 3: Inspect the Trace

filter的添加和上一张图一样。

##### 第一个GET

![](res/ins1.png)

可以看到：

Host: www.hdu.edu.cn 服务器及其端口的域名（航电服务器） 

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36   浏览器的类型及其功能（chrome浏览器）

Accept、Accept-Encoding等  对响应中可接受的格式(如文本/html)的描述，包括其编码(如gzip)和语言  

无Cookie 估计这个访问用不到cookie，涉及到登陆的网站会用cookie  

 ##### 第一个RESPONSE

![](res/cap4.png)

可以看到200 OK的表头

Server: Apache/2.4.6 (CentOS) PHP/5.4.17 服务端的类型及其功能  

Date, Last-Modified 响应时间和内容最后修改时间  

ETag: "52523-56815bc8cdb58"  

##### 问题1 header line的格式是什么?给出一个符合你所看到的标题的简单描述。

![](res/cap5.png)

每一行header包涵了一个字段的信息、冒号和 值。header之间以\r\n分开。

##### 问题2 使用什么标头来指示响应中返回的内容的种类和长度?

种类：Content-Type 数量：Content-Length  

#### Step 4: Content Caching

由于刚才没有能够对图片进行成功的第二次访问，所以在清除数据后，再做了一次捕获。

![](res/con1.png)

这一次捕获到了对于图片再次请求时得到的304 Not Modified，现在打开这个包看看：

![](res/con2.png)

##### 问题1 浏览器发送来让服务器决定是否发送新内容的标题的名称是什么?

打开浏览器发送的那个包：

![](res/con3.png)

发现三个新加的字段： Upgrade-Insecure-Requests、If-None-Match 和 If-Modified-Since。

应该时第一个字段和第三个字段配合来让服务器决定。其中第一个字段是让服务器知道要去检查一下，第三个字段是给服务器提供是否返回新图片的线索（如果新修改的时间晚于第三个字段的时间，那么就要传新的。否则不传）

##### 问题2 报头携带的时间戳值究竟来自何处?

时间戳值来自最近的下载的内容的“Last-Modified”字段。它是最后一次更改内容时的服务器时间，它不是下载时的时间。

#### Step 5: Complex Pages

是从第393个包开始的http 是找www.hdu.edu.cn的内容

然后就以 frame.number>392为条件 创建一个HTTP/Load Distribution:

![](res/cpl1.png)

创建一个 Packet Counter panel:

![](res/cpl2.png)

创建一个请求面板：

![](res/cpl3.png)

谷歌浏览器自带的查看请求的窗口：

![](res/cpl4.png)